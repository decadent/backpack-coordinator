#!/usr/bin/env node
(function() {
    var cli   = require("../lib/cli"),
        bytes = require("bytes"),
        args  = process.argv.slice(2),
        coordinator;

    if (args.length < 3) {
        console.error("Switches a shard to the read-only mode.");
        console.error("Usage: backpack-coordinator-disable-shard <zk_servers> </zk/root> <id>");
        console.error("    zk_servers: Zookeeper servers, separated with commas");
        console.error("    /zk/root: Zookeeper node with Backpack data");
        console.error("    id: ID of the shard which should be set to read-only");
        process.exit(1);
    }

    coordinator = cli.makeCoordinator(args[0], args[1]);
    coordinator.on("error", console.error.bind(console));
    coordinator.on("ready", function() {
        coordinator.disableShard(args[2], function(error) {
            if (error) {
                throw error;
            }

            console.log("Shard " + args[2] + " is read-only now");
            coordinator.close(); // close works fine here
        });
    });
})();

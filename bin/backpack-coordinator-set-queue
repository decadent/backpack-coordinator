#!/usr/bin/env node
(function() {
    var cli   = require("../lib/cli"),
        bytes = require("bytes"),
        args  = process.argv.slice(2),
        coordinator, servers;

    if (args.length < 4) {
        console.error("Sets the Redis queue servers for the Coordinator to use.");
        console.error("");
        console.error("Usage: backpack-coordinator-set-queue <zk_servers> </zk/root> <key> <host1:port1,host2:port2,..>");
        console.error("    zk_servers:  Zookeeper servers for Coordinator settings, separated with commas");
        console.error("    /zk/root:    Zookeeper root node containing Coordinator settings data");
        console.error("    key:         Redis key for the queue");
        console.error("    host1:port1,host2:port2,â€¦:  Redis queue servers");
        console.error("");
        console.error("The new specified servers replace the previous ones, not added to them.");
        process.exit(1);
    }

    coordinator = cli.makeCoordinator(args[0], args[1]);
    coordinator.on("error", console.error.bind(console));
    coordinator.on("ready", function() {
        servers = args[3].split(",").map(function(server) {
            var parts = server.split(":");
            return {host: parts[0], port: parts[1]};
        });

        coordinator.setQueueInfo(servers, args[2], function(error) {
            if (error) {
                throw error;
            }

            console.log("Queue info updated!");
            coordinator.close();
        });
    });
})();
